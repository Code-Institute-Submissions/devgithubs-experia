# Experia Testing
This README details the steps taken to stress test and validate the Experia project


 
![](README/Activity.pdf)

## Journey of a typical Experia user

### First time user - User B
- Lands on the website and sees an experience of interest
- Signs up for an account
- Browses to and finds an experience they would like to purchase
- Proceedes to checkout

### Return user - User A
- Admin
- Host 
Like user B, a Host user will return to the site on many occasions to manage their created experience(s), check admin and other fetures.


## Security
The website relies on Django's default security features
### Cross site request forgery (CSRF) protection
- Django has built-in protection against most types of CSRF attacks, providing you have enabled and used it where appropriate.
- CSRF is used to secure all of the forms and anywhere the user interacts with the applications database.
- Certain views and functionality within the app are also limited to authenticated or superuser accounts.
- These views are secured with the The [login_required](https://docs.djangoproject.com/en/4.0/topics/auth/default/#the-login-required-decorator) decorator. If the user isn’t logged in, they are redirect to the login page.

## Validation Testing
Below is a matrix of validation tests carried out on the project.


| HTML                 |   | PEP8       |   | CSS            |   |
|----------------------|---|------------|---|----------------|---|
| Index                | ✔ | See report | ✔ | See W3C report | ✔ |
| Experiences          | ✔ |            |   |                |   |
| Experiences_Detail   | ✔ |            |   |                |   |
| Host_Experience      | ✔ |            |   |                |   |
| Edit_Host_Experience | ✔ |            |   |                |   |
| Terms & Conditions   | ✔ |            |   |                |   |
| Contact              | ✔ |            |   |                |   |
| Wishlist             | ✔ |            |   |                |   |
| Profile              | ✔ |            |   |                |   |
| Bag                  | ✔ |            |   |                |   |


### HTML
All HTML validation was run through [W3C](https://validator.w3.org/)
Warnings were ignored.
- Landing page - ![View](README/index_new.PNG)
- Profile page - ![View](README/profile.PNG)
- Wishlist page - ![View](README/wishlist.PNG)
- Terms & Conditions page - ![View](README/terms_conditions.PNG)
- Host Experience page - ![View](README/host_experience.PNG)
- Edit Host Experience page - ![View](README/edit_host_experience.PNG)
- Experiences page - ![View](README/experiences.PNG)
- Experiences Detail page - ![View](README/experience_detail.PNG)
- Contact page - ![View](README/contact.PNG)
- Bag page - ![View](README/bag.PNG)
- Contact page - ![View](README/contact.PNG)

### CSS
All CSS validation was run through [W3C CSS](https://jigsaw.w3.org/css-validator/)
Warnings were ignored.
- ![View](README/css_validator.PNG)

### Python
#### PEP8
- Below is a detailed PEP8 report generated by running `$ python3 -m flake8` in the terminal on the complete code base.
- All linting issues were reviewed individually - import, whitespace, docstring, indentation, line-too-long were rectified where possible.
- It was determined that in cases where linting issues that were not materially critical i.e in Python autogenerated, environment and other files with dependancies would be left in place.

- [Report](README/PEP8_Validation.pdf)


## Responsiveness
### Google Lighthouse 
Google Lighthouse audits performance, accessibility and search engine optimization of web pages for quality.

- Google Lighthouse - ![Desktop](README/lighthouse_desktop.PNG)
- Performance - 89/100
- Accessibility - 93/100
- Best Practices - 93/100
- SEO - 80/100

- Google Lighthouse - ![Mobile](README/lighthouse_mobile.PNG)
- Performance - 84/100
- Accessibility - 93/100
- Best Practices - 94/100
- SEO - 83/100


## Bugs
- AWS bucket - Media file not rendering uploaded images to website
- CSRF token - Had to add CSRF_TRUSTED_ORIGINS to settings.py
- Webhook handler 'payment_intent.succeeded' 500 error
- Footer floating

- Issue: AWS S3 images were not being served after manual upload.
- Cause: On set up of the bucket the media file was at the wrong level of hierarchy. 
- Solution: Checked the bucket set up from the begining, eliminated each step until it was found that the url was not correct and fixed. Images loaded as expected

- Issue: CSRF token not from trusted source. Preventing form submission across website.
- Cause: Saw on Stackoverflow that the error can be caused when the POST request came from an untrusted source.
- Solution: Setting the CSRF_TRUSTED_ORIGINS = ['localhost'] eliminated the error.

- Issue: Noticed that the confirmation email from Stripe webhook was not clearing. Checked the Stipe dashboard and saw payment_intent.created and charge.succeeded webhooks were returning OK 200 responses but payment_intent.succeeded was showing 500 error with no response
- Cause: Mismatch in the variable name in the view request for the email field from the Order model 
- Solution: A tricky one to debug but when the function was targeting the correct model field it worked, payment_intent.succeeded = 200 OK and the confirmation email was sent to the email inbox.  

- Issue: Footer not staying at the bottom of some webpages.
- Cause: This usually occurs on pages when there is not enough content to push the footer down.
- Solution: Found a handy solution here: [Fix](https://radu.link/make-footer-stay-bottom-page-bootstrap/)
    - Step 1: Add these Bootstrap classes to the 'body' tag `d-flex flex-column min-vh-100`
    - Step 2: Add the `mt-auto` class to the 'footer' or wrapper if you use any.